<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="一个博客">
<meta property="og:type" content="website">
<meta property="og:title" content="追寻事">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="追寻事">
<meta property="og:description" content="一个博客">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="追寻事">
<meta name="twitter:description" content="一个博客">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/3/"/>





  <title>追寻事</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">追寻事</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Startseite
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archiv
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/14/docker_command/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ted1769">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="追寻事">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/14/docker_command/" itemprop="url">Docker 命令</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-12-14T11:33:19+08:00">
                2017-12-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="namespace-的-6项隔离"><a href="#namespace-的-6项隔离" class="headerlink" title="namespace 的 6项隔离"></a>namespace 的 6项隔离</h3><table>
<thead>
<tr>
<th>namespace</th>
<th style="text-align:center">系统调用参数</th>
<th style="text-align:right">隔离内容</th>
</tr>
</thead>
<tbody>
<tr>
<td>UTS</td>
<td style="text-align:center">CLONE_NEWUTS</td>
<td style="text-align:right">主机名和域名</td>
</tr>
<tr>
<td>IPC</td>
<td style="text-align:center">CLONE_NEWIPC</td>
<td style="text-align:right">信号量、消息队列和共享内存</td>
</tr>
<tr>
<td>PID</td>
<td style="text-align:center">CLONE_NEWPID</td>
<td style="text-align:right">进程ID</td>
</tr>
<tr>
<td>Network</td>
<td style="text-align:center">CLONE_NEWNET</td>
<td style="text-align:right">网络设备、端口、网络栈等</td>
</tr>
<tr>
<td>Mount</td>
<td style="text-align:center">CLONE_NEWNS</td>
<td style="text-align:right">文件系统</td>
</tr>
<tr>
<td>User</td>
<td style="text-align:center">CLONE_NEWUSER</td>
<td style="text-align:right">用户和用户组</td>
</tr>
</tbody>
</table>
<h3 id="Docker-子命令，示例图-及-说明"><a href="#Docker-子命令，示例图-及-说明" class="headerlink" title="Docker 子命令，示例图 及 说明"></a>Docker 子命令，<a href="https://segmentfault.com/img/bVdlRG" target="_blank" rel="noopener">示例图</a> 及 <a href="https://segmentfault.com/a/1190000000751601" target="_blank" rel="noopener">说明</a></h3><p><strong><em> ctrl+d 退出容器且关闭, docker ps 查看无 </em></strong><br><strong><em> ctrl+p+q 退出容器但不关闭, docker ps 查看有 </em></strong></p>
<blockquote>
<p>Docker环境信息：<code>info</code>,<code>version</code></p>
<p>容器生命周期管理：<code>create</code>,<code>exec</code>,<code>kill</code>,<code>pause</code>,<code>restart</code>,<code>rm</code>,<code>run</code>,<code>start</code>,<code>stop</code>,<code>unpause</code>,<code>,</code>,<code>,</code>,``</p>
<p>镜像仓库命令：<code>login</code>,<code>logout</code>,<code>pull</code>,<code>push</code>,<code>search</code></p>
<p>镜像管理:<code>build</code> –&gt;根据Dockerfile 生成 image<br>        <code>commit</code>,<code>rmi</code>,<code>load</code>,<code>save</code>,<code>tag</code></p>
<p>容器运维操作：<code>attach</code>,<code>import</code>,<code>export</code>,<code>rename</code>,<code>wait</code>,<code>cp</code>,<code>diff</code>,<code>update</code>,</p>
<p>容器监控命令：<br><code>ps</code>：容器信息<br><code>top</code>：容器信息<br><code>images</code>：镜像信息<br><code>inspect</code>:ron<br><code>stats</code>：只有在选用 <code>libcontainer</code> 作为driver才能使用<br><code>port</code>：查看容器与主机之前的端口映射关系信息</p>
<p>容器资源管理：<code>volume</code>,<code>network</code></p>
<p>系统日志信息：<code>events</code>,<code>history</code>,<code>logs</code></p>
</blockquote>
<h3 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h3><blockquote>
<p>指令：<strong>第一条指令必须是FROM指令，提供基础镜像</strong><br>    <code>FROM</code>：image 或者 image:tag<br>    <code>ENV</code>: key value 或者 key = value :环境变量<br>    <code>COPY</code>: src dest :复制src的文件添加到新镜像中。<br>    <code>ADD</code>： src dest：与COPY类似，推荐COPY,因为COPY只支持本地文件，相对ADD更透明<br>    <code>RUN</code>:command :shell格式<br>          “executable”，”param1”,”param2”:exec格式，推荐。不调用shell,参数会当成JSON数组被Docker解析，必须使用双引号，<br>    在镜像的基础上创建一个容器，并在容器中运行命令。命令结束后提交容器为新镜像，为吓一跳指令使用。<br>    <code>CMD</code>:command:shell 格式<br>          “executable”，”param1”,”param2”:exec格式，推荐<br>          “param1”,”param2”：为<code>ENTRYPOINT</code>指令提供参数<br>1 一个Dockerfile可以有多个CMD指令，但只有最有一条有效。<br>2 使用<em>shell</em>和<em>exec</em>格式时，命令与<code>RUN</code>相同。区别：<code>RUN</code>在构建镜像时执行命令，并生成新的镜像；<code>CMD</code>在构建镜像是不执行命令，而是在容器启动时默认将<code>CMD</code>指令作为第一条执行的命令。若用户在命令行界面<code>docker run</code>指令了命令参数，会覆盖<code>CMD</code>的命令</p>
</blockquote>
<pre><code>`ENTRYPOINT`：command:shell 格式
      &quot;executable&quot;，&quot;param1&quot;,&quot;param2&quot;:exec格式，推荐
      命令与`CMD`类似，都可以在容器启动时执行命令。
      一个Dockerfile可以有多个`ENTRYPOINT`指令，但只有最有一条有效.
</code></pre><h3 id="Dockerfile-实践心得"><a href="#Dockerfile-实践心得" class="headerlink" title="Dockerfile 实践心得"></a>Dockerfile 实践心得</h3><ul>
<li>使用标签（x.y 而不是 :latest）</li>
<li>构建Docker镜像时，只安装和更新要用的包。更推荐使用轻量级的包，大小比较：busybox &lt; debian &lt; centos &lt; ubuntu</li>
<li><code>FROM</code> 应该包含tag，如 FROM <code>debian:jessie</code> 而不是 <code>FROM debian</code></li>
<li>Docker daemon 会顺序执行Dockerfile中的指令，而一旦缓存失效，后续命令不能使用缓存。为有效利用缓存，需保证指令的连续性，尽量将Dockerfile中相同的部分放前面，不同的放后面</li>
<li><p>正确使用<code>ADD</code> 与 <code>COPY</code></p>
<ul>
<li>优先使用 <code>COPY</code>.</li>
<li>不推荐使用<code>ADD</code>去获取远程URL的压缩包，应该使用<code>RUN wget</code>或者 <code>RUN curl</code>.这样可以删除解压后不要需要的文件。</li>
</ul>
</li>
<li><p><code>RUN</code> 不要讲所有命令写在一个<code>RUN</code> 指令里。</p>
<ul>
<li>不要在一行中单独使用<code>RUN apt-get update</code>,容易引起缓存问题,导致<code>RUN apt-get install</code> 运行失败。应该将<code>RUN apt-get update</code> 和 <code>RUN apt-get install -y  package...</code> 放在一行</li>
<li>避免使用指令<code>RUN apt-get update</code> 和 <code>RUN apt-get dist-update</code></li>
</ul>
</li>
<li>不要在Dockerfile 中做端口映射<br>  不要 <code>EXPOSE 80:8080</code>，仅暴露端口<code>EXPOSE 80</code>,另做映射</li>
<li>使用Dockerfile 共享 Docker 镜像<ul>
<li>Dockerfile 可以 加入版本控制，追踪变化和回滚错误</li>
<li>可以清楚镜像构建的过程</li>
<li>具有确定性</li>
<li>少占地方</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/14/compiler_pricinpel/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ted1769">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="追寻事">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/14/compiler_pricinpel/" itemprop="url">编译原理基础</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-12-14T11:33:19+08:00">
                2017-12-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">source code=&gt;start: 源代码</span><br><span class="line">frontend=&gt;operation: 编译前端</span><br><span class="line">IR=&gt;operation: 中间表示(IR)</span><br><span class="line">backend=&gt;operation: 编译后端</span><br><span class="line">end=&gt;end: 目标代码</span><br><span class="line"></span><br><span class="line">source code(right)-&gt;frontend</span><br><span class="line">frontend(right)-&gt;IR</span><br><span class="line">IR(right)-&gt;backend</span><br><span class="line">backend(right)-&gt;end</span><br></pre></td></tr></table></figure>
<p>以上是编译的大体过程，编译器要做的就是中间三部分。<br>以<code>IR</code>为分界线，<code>编译前端</code>主要与<code>源码</code>有关，而<code>编译后端</code>与<code>目标代码</code>有关。</p>
<p><strong>前端总揽</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">source code=&gt;start: 源代码</span><br><span class="line">词法分析=&gt;operation: 词法分析器</span><br><span class="line">语法分析=&gt;operation: 语法分析器</span><br><span class="line">语义分析=&gt;operation: 语义分析器</span><br><span class="line">IR=&gt;end: 中间表示(IR)</span><br><span class="line"></span><br><span class="line">source code(right)-&gt;词法分析</span><br><span class="line">词法分析(right)(记号)-&gt;语法分析</span><br><span class="line">语法分析(right)-&gt;语义分析</span><br><span class="line">语义分析(right)-&gt;IR</span><br></pre></td></tr></table></figure></p>
<p><em>词法分析器</em><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">source code=&gt;start: 源代码</span><br><span class="line">词法分析=&gt;operation: 词法分析器</span><br><span class="line">语法分析=&gt;end: 记号(单词)</span><br><span class="line"></span><br><span class="line">source code(right)-&gt;词法分析</span><br><span class="line">词法分析(right)(记号)-&gt;语法分析</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/14/centos7.3_smokeping/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ted1769">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="追寻事">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/14/centos7.3_smokeping/" itemprop="url">centos7.3 安装 smokeping</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-12-14T11:33:19+08:00">
                2017-12-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li><p>安装依赖包 <code>yum install -y perl perl-Net-Telnet perl-Net-DNS perl-LDAP perl-libwww-perl perl-IO-Socket-SSL perl-Socket6 perl-Time-HiRes perl-ExtUtils-MakeMaker rrdtool rrdtool-perl curl httpd httpd-devel gcc make wget libxml2-devel libpng-devel glib pango pango-devel freetype freetype-devel fontconfig cairo cairo-devel libart_lgpl libart_lgpl-devel popt popt-devel libidn libidn-devel</code></p>
</li>
<li><p>源码安装 <strong>cgilib</strong>：<br><code>cd /usr/local/    
mkdir cgilib  
cd cgilib/ 
wget http://down1.chinaunix.net/distfiles/cgilib-0.5.tar.gz 
tar zxvf cgilib-0.5.tar.gz 
cd cgilib-0.5/ 
make 
cp libcgi.a /usr/local/lib</code><br>cp cgi.h /usr/include/ –保留</p>
</li>
<li><p>如果能 <code>yum install fping echoping</code> 最好，查看 是否有安装 <em>fping</em> 和 <em>echoping</em>：<code>yun info installed fping echoping</code>,如果不能 yum 安装 ，就需要源码安装<br>源码安装 <strong>fping</strong>：<br><code>cd /usr/local/     
mkdir fping
cd fping/
 wget http://fping.sourceforge.net/download/fping.tar.gz
 tar zxvf fping.tar.gz
 cd fping-2.4b2_to/
 ./configure
 make &amp;&amp; make install</code><br>源码安装 <strong>echoping</strong>:<br>  <code>cd /usr/local/
   mkdir echoping
  tar xzvf echoping-6.0.2.tar.gz
  cd echoping-6.0.2/
  ./configure
  make &amp;&amp; make install</code></p>
</li>
<li><p>源码安装<strong>smokeping</strong>：<br><code>cd /usr/local/
mkdir smokeping
cd smokeping/
tar vxf smokeping-2.6.11.tar.gz
cd smokeping-2.6.11/
./setup/build-perl-modules.sh /usr/local/smokeping/thirdparty
./configure --prefix=/usr/local/smokeping
/usr/bin/gmake install</code></p>
</li>
<li><p>配置 <strong>smokeping</strong><br><code>cd /usr/local/smokeping/
mkdir cache data var
touch /var/log/smokeping.log
chown apache:apache cache data var
chown apache:apache /var/log/smokeping.log
chmod 600 /usr/local/smokeping/etc/smokeping_secrets.dist
cd /usr/local/smokeping/htdocs
cp smokeping.fcgi.dist smokeping.fcgi
cd /usr/local/smokeping/etc
cp config.dist config</code></p>
</li>
<li><p>更改配置文件<br><code>vim /usr/local/smokeping/etc/config</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#cgiurl = http://some.url/smokeping.cgi</span><br><span class="line">cgiurl = http://10.137.37.26/smokeping.cgi</span><br><span class="line"></span><br><span class="line">*** Database ***</span><br><span class="line">#step = 300</span><br><span class="line">step = 60 #此处建议改为 60 ， 一分钟采集一次数据</span><br><span class="line">pings = 20</span><br></pre></td></tr></table></figure>
</li>
<li><p>编辑 httpd 文件<br><code>vim /etc/httpd/conf/httpd.conf</code><br>1）将所有 deny from all （禁止所有访问） 注释。<br>2）最后边添加如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Alias /cache &quot;/usr/local/smokeping/cache/&quot;</span><br><span class="line">Alias /cropper &quot;/usr/local/smokeping/htdocs/cropper/&quot;</span><br><span class="line">Alias /smokeping &quot;/usr/local/smokeping/htdocs/smokeping.fcgi&quot;</span><br><span class="line">&lt;Directory &quot;/usr/local/smokeping&quot;&gt;</span><br><span class="line">AllowOverride None</span><br><span class="line">Options All</span><br><span class="line">AddHandler cgi-script .fcgi .cgi</span><br><span class="line">Order allow,deny</span><br><span class="line">Allow from all</span><br><span class="line">DirectoryIndex smokeping.fcgi</span><br><span class="line">&lt;/Directory&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>测试数据：<br><code>vim /usr/local/smokeping/etc/config</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> #第110更改fping的目录为</span><br><span class="line">binary = /usr/local/sbin/fping</span><br></pre></td></tr></table></figure>
<p>  <strong><em> 最后添加测试 </em></strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">+ Other</span><br><span class="line">++ internet</span><br><span class="line">menu = internet-ping</span><br><span class="line">title = baidu &amp;&amp; 163</span><br><span class="line">host = /Other/internet/163 /Other/internet/baidu</span><br><span class="line">+++ 163</span><br><span class="line">menu = www.163.com</span><br><span class="line">title = www.163.com</span><br><span class="line">alerts = someloss</span><br><span class="line">host = 14.215.9.85</span><br><span class="line"></span><br><span class="line">+++ baidu</span><br><span class="line">menu = www.baidu.com</span><br><span class="line">title = www.baidu.com</span><br><span class="line">alerts = someloss</span><br><span class="line">host = 14.215.177.38</span><br></pre></td></tr></table></figure>
</li>
<li><p>重启httpd 和 smokeing ,增加环境变量<br><code>systemctl restart httpd</code><br><code>/usr/local/smokeping/bin/smokeping restart</code><br>自带的restart脚本，进程清除不干净，重新写了个脚本：restart-smokeping</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#! /usr/bin/env bash</span></span><br><span class="line">ps -ef | grep smokeping | grep -v grep | grep <span class="string">'/usr/local/smokeping/bin/smokeping'</span> | awk -F <span class="string">" "</span> <span class="string">'&#123;print $2&#125;'</span> | xargs <span class="built_in">kill</span></span><br><span class="line">sleep 2</span><br><span class="line">/usr/<span class="built_in">local</span>/smokeping/bin/smokeping restart</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><code>echo &#39;export PATH=/usr/local/smokeping/bin/:$PATH&#39; &gt;&gt; /etc/profile</code></p>
<ul>
<li><p>打开前端<br><code>http://10.137.37.26/smokeping</code></p>
</li>
<li><p>碰到的问题：<br>1）  <code>You don&#39;t have permission to access /smokeping on this server.</code><br>  问题描述：没有权限访问路径<br>  排查：是 <code>httpd</code>配置文件出了问题，查看/etc/httpd/conf/httpd.conf:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Alias /cache &quot;/usr/local/smokeping/cache/&quot;</span><br><span class="line">Alias /cropper &quot;/usr/local/smokeping/htdocs/cropper/&quot;</span><br><span class="line">Alias /smokeping &quot;/usr/local/smokeping/htdocs/smokeping.fcgi&quot;</span><br><span class="line">&lt;Directory &quot;/usr/local/smokeping&quot;&gt;</span><br><span class="line">AllowOverride None</span><br><span class="line">#Options All</span><br><span class="line">AddHandler cgi-script .fcgi .cgi .sh .pl</span><br><span class="line">Order allow,deny</span><br><span class="line"> Options ExecCGI</span><br><span class="line">Allow from all</span><br><span class="line">&lt;IfModule dir_module&gt;</span><br><span class="line">   DirectoryIndex smokeping.fcgi</span><br><span class="line">   &lt;/IfModule&gt;</span><br><span class="line">&lt;/Directory&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>这部分没问题，往上走，发现有<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Directory&gt;</span><br><span class="line">     deny from all</span><br><span class="line">&lt;/Directory&gt;</span><br></pre></td></tr></table></figure></p>
<p>将其注释，重启httpd，出现其他错误，这错误已解决。</p>
<p> 2） <code>ERROR: Could not save Other_mini.png to /usr/local/smokeping/cache</code><br> 问题描述：不知道问题出在哪里，<br> 排查：进去<code>/usr/local/smokeping/cache</code> 查看，发现已经存在 Other_mini.png, 试着将其删除，解决。<br> 3） <code>gmake[1]: *** [Smokeping_probes_EchoPingSmtp.pod] Error 2</code> google了一下，解决：<code>yum search all perl | grep -i “syslog”  ---&gt;  yum install  perl-Sys-Syslog</code><br> 4） <code>Software error:ERROR: creating/usr/local/smokeping/cache/Other: No such file or directory</code><br> 问题描述：在data下有文件，而cache无任何文件<br> 解决：本机虚拟机上做的操作，<code>selinux</code> 没有关闭 .  将其关闭 <code>vim /etc/selinux/config</code>: <code>SELINUX=disabled</code>  重启即可</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/14/centos_r_sparkr/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ted1769">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="追寻事">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/14/centos_r_sparkr/" itemprop="url">CentOS 6.5 安装R 和 RStudio 以及 SparkR</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-12-14T11:33:19+08:00">
                2017-12-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="R"><a href="#R" class="headerlink" title="R"></a>R</h2><h3 id="在安装R之前需要安装的插件，否则报错"><a href="#在安装R之前需要安装的插件，否则报错" class="headerlink" title="在安装R之前需要安装的插件，否则报错"></a>在安装R之前需要安装的插件，否则报错</h3><p><code>yum install -y gcc gcc-devel gcc-gfortran gcc-c++ readline-devel libXt-devel texinfo texlive libpng libpng-devel libtiff libtiff-devel libjpeg-turbo libjpeg-turbo-devel</code><br>查看是否有相应的包<br><code>yum search gcc-devel</code></p>
<h3 id="源码安装R"><a href="#源码安装R" class="headerlink" title="源码安装R"></a>源码安装R</h3><p><code>mkdir /usr/local/R</code><br><code>tar -zxvf R-3.2.2.tar.gz</code><br><code>cd R-3.2.2</code><br><code>./configure --enable-R-shlib --with-libpng --with-jpeglib --with-libtiff --with-x</code> //enable-R-shlib 支持RStudio<br><code>make clean</code><br><code>make</code><br><code>make install</code><br>    遇到的问题：1、无法安装pdf</p>
<pre><code>/usr/bin/install: 无法获取&quot;NEWS.pdf&quot; 的文件状态(stat):     没有那个文件或目录
/usr/bin/install: 无法获取&quot;NEWS.pdf&quot; 的文件状态(stat):     没有那个文件或目录
=&gt; 
</code></pre><p>进入R，检查安装是否成功</p>
<p><code>R</code><br><code>capabilities()</code> // 看是否支持相应的图形化界面<br>装完R之后，还要安装rJava<br><code>R CMD INSTALL rJava_0.9-7.tar.gz</code><br><code>R CMD INSTALL rhdfs_1.0.8.tar.gz</code><br><code>R CMD INSTALL Rserve_1.7-2.tar.gz</code><br><code>R CMD INSTALL RHive_2.0-0.2.tar.gz</code></p>
<h2 id="RStudio"><a href="#RStudio" class="headerlink" title="RStudio"></a>RStudio</h2><h3 id="安装-RStudio"><a href="#安装-RStudio" class="headerlink" title="安装 RStudio"></a>安装 RStudio</h3><p><code>wget https://download2.rstudio.org/rstudio-server-rhel-0.99.473-x86_64.rpm</code><br><code>sudo yum install --nogpgcheck rstudio-server-rhel-0.99.473-x86_64.rpm</code></p>
<h3 id="检查是否安装成功"><a href="#检查是否安装成功" class="headerlink" title="检查是否安装成功"></a>检查是否安装成功</h3><p><code>rstudio-server verify-installation</code><br>如果R <code>./configure</code>没有加 <code>--enable-R-shlib</code>,此命令就会报错。</p>
<h3 id="使用浏览器访问rstudio-server"><a href="#使用浏览器访问rstudio-server" class="headerlink" title="使用浏览器访问rstudio-server"></a>使用浏览器访问rstudio-server</h3><p><code>http://x.x.x.x:8787</code></p>
<h3 id="增加权限用户"><a href="#增加权限用户" class="headerlink" title="增加权限用户"></a>增加权限用户</h3><p>在 <code>vi /etc/rstudio/rserver.conf</code>加入一行<code>auth-required-user-group=rstudio_users</code><br>在终端新增用户组</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">groupadd rstudio_users </span><br><span class="line">useradd r_user </span><br><span class="line">usermod -a -G rstudio_users r_user </span><br><span class="line">passwd r_user</span><br></pre></td></tr></table></figure>
<p>如此，r_user 就能访问rstudio-server 服务器啦。</p>
<h2 id="SparkR"><a href="#SparkR" class="headerlink" title="SparkR"></a>SparkR</h2><h3 id="spark-env-sh-的配置"><a href="#spark-env-sh-的配置" class="headerlink" title="spark-env.sh 的配置"></a>spark-env.sh 的配置</h3><p>在<code>{SPARK_HOME}/conf/spark-env.sh</code> 中加入</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> SPARK_DIST_CLASSPATH=<span class="variable">$&#123;HADOOP_HOME&#125;</span>/bin/hadoop</span><br><span class="line"><span class="built_in">export</span> HADOOP_CONF_DIR=/etc/hive/conf</span><br></pre></td></tr></table></figure>
<h3 id="etc-profile-的配置"><a href="#etc-profile-的配置" class="headerlink" title="/etc/profile 的配置"></a>/etc/profile 的配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/usr/java/jdk1.7.0_67-cloudera</span><br><span class="line">export CLASSPATH=$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$CLASSPATH</span><br><span class="line">export HADOOP_HOME=/opt/cloudera/parcels/CDH/lib/hadoop</span><br><span class="line">export HADOOP_CONF_DIR=/etc/hadoop/conf</span><br><span class="line">export HADOOP_CMD=$HADOOP_HOME/bin/hadoop</span><br><span class="line">export SPARK_DIST_CLASSPATH=$(hadoop --config /etc/hadoop/conf/ classpath)</span><br></pre></td></tr></table></figure>
<p>以下这些不是必须：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export HADOOP_COMMON_HOME=/opt/cloudera/parcels/CDH-5.4.2-1.cdh5.4.2.p0.2/lib/hadoop/libexec/../../hadoop</span><br><span class="line">export HADOOP_HDFS_HOME=/opt/cloudera/parcels/CDH-5.4.2-1.cdh5.4.2.p0.2/lib/hadoop/libexec/../../hadoop-hdfs</span><br><span class="line">export HADOOP_MAPRED_HOME=/opt/cloudera/parcels/CDH-5.4.2-1.cdh5.4.2.p0.2/lib/hadoop/libexec/../../hadoop-mapreduce</span><br><span class="line">export HADOOP_YARN_HOME=/opt/cloudera/parcels/CDH-5.4.2-1.cdh5.4.2.p0.2/lib/hadoop/libexec/../../hadoop-yarn</span><br></pre></td></tr></table></figure>
<h3 id="在R命令行中加入sparkR需要的包"><a href="#在R命令行中加入sparkR需要的包" class="headerlink" title="在R命令行中加入sparkR需要的包"></a>在R命令行中加入sparkR需要的包</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Sys.setenv(JAVA_HOME=<span class="string">"/usr/java/jdk1.7.0_67-cloudera"</span>)</span><br><span class="line">Sys.setenv(HADOOP_CMD=<span class="string">"/opt/cloudera/parcels/CDH/lib/hadoop/bin/hadoop"</span>)</span><br><span class="line">Sys.setenv(SPARK_HOME =<span class="string">"/home/loguser/spark-1.6.1-bin-hadoop2.6"</span> )</span><br><span class="line">.libPaths(c(file.path(Sys.getenv(<span class="string">"SPARK_HOME"</span>), <span class="string">"R"</span>, <span class="string">"lib"</span>), .libPaths()))</span><br><span class="line"><span class="keyword">library</span>(<span class="string">"rJava"</span>)</span><br><span class="line"><span class="keyword">library</span>(<span class="string">"rhdfs"</span>)</span><br><span class="line"><span class="keyword">library</span>(<span class="string">"RHive"</span>)</span><br><span class="line"><span class="keyword">library</span>(SparkR)</span><br><span class="line">sc=sparkR.init(sparkHome = <span class="string">"/home/loguser/spark-1.6.1-bin-hadoop2.6"</span>)</span><br><span class="line">hiveContext=sparkRHive.init(sc)</span><br></pre></td></tr></table></figure>
<p>真正的查询：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">results &lt;- sql(hiveContext,<span class="string">"select account_ from xxx.xxxx where date_ = '20160502' limit 10"</span>)</span><br><span class="line">head(results)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/14/cdh_optimizer/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ted1769">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="追寻事">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/14/cdh_optimizer/" itemprop="url">CDH 调优</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-12-14T11:33:19+08:00">
                2017-12-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近集群扩容，但是看了一下Yarn任务，还是很慢，是不是上一次没有优化。重新翻开配置，配置参数主要参考了<a href="http://public-repo-1.hortonworks.com/HDP/tools/2.0.6.0/hdp_manual_install_rpm_helper_files-2.0.6.101.tar.gz" target="_blank" rel="noopener">hdp的文档</a>,输入了机器的配置情况，<br><code>python yarn-utils.py -c 32 -m 64 -d 12 -k True</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Using cores=32 memory=64GB disks=12 hbase=True</span><br><span class="line">Profile: cores=32 memory=49152MB reserved=16GB usableMem=48GB disks=12</span><br><span class="line">Num Container=22</span><br><span class="line">Container Ram=2048MB</span><br><span class="line">Used Ram=44GB</span><br><span class="line">Unused Ram=16GB</span><br><span class="line">yarn.scheduler.minimum-allocation-mb=2048</span><br><span class="line">yarn.scheduler.maximum-allocation-mb=45056</span><br><span class="line">yarn.nodemanager.resource.memory-mb=45056</span><br><span class="line">mapreduce.map.memory.mb=2048</span><br><span class="line">mapreduce.map.java.opts=-Xmx1638m</span><br><span class="line">mapreduce.reduce.memory.mb=4096</span><br><span class="line">mapreduce.reduce.java.opts=-Xmx3276m</span><br><span class="line">yarn.app.mapreduce.am.resource.mb=4096</span><br><span class="line">yarn.app.mapreduce.am.command-opts=-Xmx3276m</span><br><span class="line">mapreduce.task.io.sort.mb=819</span><br></pre></td></tr></table></figure></p>
<p>以前的配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">yarn.scheduler.minimum-allocation-mb=1G</span><br><span class="line">yarn.scheduler.maximum-allocation-mb=64G</span><br><span class="line">yarn.nodemanager.resource.memory-mb=NodeManager(48G)</span><br><span class="line">mapreduce.map.memory.mb=2048</span><br><span class="line">mapreduce.map.java.opts=-Xmx787m</span><br><span class="line">mapreduce.reduce.memory.mb=3G</span><br><span class="line">mapreduce.reduce.java.opts=-Xmx787m</span><br><span class="line">yarn.app.mapreduce.am.resource.mb=1G</span><br><span class="line">yarn.app.mapreduce.am.command-opts=-Xmx3276m</span><br><span class="line">mapreduce.task.io.sort.mb=256</span><br></pre></td></tr></table></figure></p>
<p>扩容的机器：<code>python yarn-utils.py -c 40 -m 64 -d 16 -k True</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Using cores=40 memory=64GB disks=16 hbase=True</span><br><span class="line">Profile: cores=40 memory=49152MB reserved=16GB usableMem=48GB disks=16</span><br><span class="line">Num Container=24</span><br><span class="line">Container Ram=2048MB</span><br><span class="line">Used Ram=48GB</span><br><span class="line">Unused Ram=16GB</span><br><span class="line">yarn.scheduler.minimum-allocation-mb=2048</span><br><span class="line">yarn.scheduler.maximum-allocation-mb=49152</span><br><span class="line">yarn.nodemanager.resource.memory-mb=49152</span><br><span class="line">mapreduce.map.memory.mb=2048</span><br><span class="line">mapreduce.map.java.opts=-Xmx1638m</span><br><span class="line">mapreduce.reduce.memory.mb=4096</span><br><span class="line">mapreduce.reduce.java.opts=-Xmx3276m</span><br><span class="line">yarn.app.mapreduce.am.resource.mb=4096</span><br><span class="line">yarn.app.mapreduce.am.command-opts=-Xmx3276m</span><br><span class="line">mapreduce.task.io.sort.mb=819</span><br></pre></td></tr></table></figure></p>
<p>以前的配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">yarn.scheduler.minimum-allocation-mb=1G</span><br><span class="line">yarn.scheduler.maximum-allocation-mb=64G</span><br><span class="line">yarn.nodemanager.resource.memory-mb=NodeManager(48G)</span><br><span class="line">mapreduce.map.memory.mb=2048</span><br><span class="line">mapreduce.map.java.opts=-Xmx787m</span><br><span class="line">mapreduce.reduce.memory.mb=3G</span><br><span class="line">mapreduce.reduce.java.opts=-Xmx787m</span><br><span class="line">yarn.app.mapreduce.am.resource.mb=1G</span><br><span class="line">yarn.app.mapreduce.am.command-opts=-Xmx3276m</span><br><span class="line">mapreduce.task.io.sort.mb=256</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/14/cdh_offline_install/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ted1769">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="追寻事">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/14/cdh_offline_install/" itemprop="url">CDH5.4.2 离线安装 - rhel6.6</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-12-14T11:33:19+08:00">
                2017-12-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-前置条件"><a href="#1-前置条件" class="headerlink" title="1 前置条件"></a>1 前置条件</h3><ul>
<li><p>关闭防火墙</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">service iptables stop </span><br><span class="line">　　chkconfig iptables off</span><br></pre></td></tr></table></figure>
</li>
<li><p>vi /etc/selinux/config 文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">将SELINUX=enforcing改为SELINUX=disabled (需重启)</span><br></pre></td></tr></table></figure>
</li>
<li><p><em>所有节点</em> 更改<code>host</code>文件</p>
<ol>
<li><p>vi /etc/sysconfig/network</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HOSTNAME=r01-hadoop01.com</span><br></pre></td></tr></table></figure>
<p>2.vi /etc/hosts</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">10.137.37.25 r01-hadoop01.com hadoop01</span><br><span class="line">10.137.37.26 r01-hadoop02.com hadoop02</span><br><span class="line">10.137.37.27 r01-hadoop03.com hadoop03</span><br><span class="line">10.137.37.28 r01-hadoop04.com hadoop04</span><br></pre></td></tr></table></figure>
<p>3 重启网络</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service network restart</span><br></pre></td></tr></table></figure>
<p>4 重启机器，hostname 重启机器后，才看得到变化</p>
</li>
</ol>
</li>
<li><p>无密码登录<br>  <em>所有节点</em> <code>ssh-keygen -t rsa</code><br>  <em>主节点</em></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat .ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys</span><br><span class="line">scp ~/.ssh/authorized_keys root@r01-hadoop04.com:~/.ssh/</span><br></pre></td></tr></table></figure>
</li>
<li><p><em>所有节点</em> 安装<code>java</code><br>  <code>cd /var/www/html/</code></p>
</li>
</ul>
<ol>
<li>删除系统已有的openjdk 版本 ,否则会出现安装hdfs时 出现”permission denies” 问题</li>
<li>安装Oracle的Java（所有节点）<br><strong>采用rpm的安装方式，而不要采用tar解压的安装方式</strong>。因为rpm的安装方式，会在/usr/lib下新建两个软连接<br>由于是rpm包并不需要我们来配置环境变量，我们只需要配置一个全局的JAVA_HOME变量即可，执行命令：<br>echo “JAVA_HOME=/usr/java/latest/“ &gt;&gt; /etc/environment<br>执行命令java -version和javac -version，查看Jdk是否安装正确。</li>
</ol>
<ul>
<li><p><em>主节点</em> 配置yum源</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/yum.repos.d</span><br><span class="line">yum -y install httpd</span><br><span class="line">yum -y install createrepo</span><br></pre></td></tr></table></figure>
<p>  1 配置file源 -&gt; <code>vi local.repo</code>,将rpm放在<code>/media/Packages</code>下，还需要<code>repodata</code>文件夹与<code>Packages</code> 同级目录</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[local]</span><br><span class="line">name=local</span><br><span class="line">baseurl=file:///media</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br></pre></td></tr></table></figure>
</code></pre><p>  2.配置http源<br>  <code>vi /etc/httpd/conf/httpd.conf</code></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DocumentRoot &quot;/var/www/html&quot;</span><br></pre></td></tr></table></figure>
<p>  刚好就用上了1配置好的本地源来安装软件<br>  将 <code>cloudera-manager</code>相关的 rpm 包<a href="http://archive.cloudera.com/cm5/redhat/6/x86_64/cm/5.4.3/RPMS/x86_64/" target="_blank" rel="noopener">下载地址</a>放入到<code>/var/www/html/cloudera-manager</code> 下</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">createrepo /var/www/html</span><br><span class="line">vi cloudera-manager.repo</span><br></pre></td></tr></table></figure>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[cloudera-manager]</span><br><span class="line">name = Cloudera Manager, Version 5.4.3</span><br><span class="line">baseurl = http://10.137.37.25/cloudera-manager/</span><br><span class="line">gpgcheck = 0</span><br></pre></td></tr></table></figure>
<p>  为方便多节点部署，将<code>cloudera-manager.repo</code> <code>scp</code>到每个节点的 <code>/etc/yum.repos.d</code>,这样每个节点都能够读取主master repo下的rpms了。</p>
</li>
<li><p><em>主节点</em> 安装 mysql<br>  基于前面配置好的yum源，就可以安装软件啦。<br>  <code>yum install mysql-server</code><br>  添加为自启动<code>chkconfig mysqld on</code><br>  启动mysql <code>service mysqld start</code><br>  修改root密码<code>mysqladmin -u root password &#39;123456&#39;</code><br>  进入mysql<code>mysql -uroot -p123456</code><br>  创建数据库</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">create database hive DEFAULT CHARSET utf8 COLLATE utf8_general_ci;</span><br><span class="line">create database amon DEFAULT CHARSET utf8 COLLATE utf8_general_ci;</span><br><span class="line">create database hue default charset utf8 collate utf8_general_ci;</span><br><span class="line">create database navigator_audit_server default charset utf8 collate utf8_general_ci;</span><br><span class="line">create database navigator_metadata_server default charset utf8 collate utf8_general_ci;</span><br><span class="line">create database reports_manager default charset utf8 collate utf8_general_ci;</span><br><span class="line">create database Oozie default charset utf8 collate utf8_general_ci;</span><br></pre></td></tr></table></figure>
<p>  授权</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grant all privileges on *.* to &apos;root&apos;@&apos;%&apos; identified by &apos;123456&apos; with grant option;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="2-安装-cloudera-manager"><a href="#2-安装-cloudera-manager" class="headerlink" title="2 安装 cloudera manager"></a>2 安装 cloudera manager</h3><ul>
<li><p>所有节点创建cloudera-scm用户</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useradd --system --home=/opt/cm-5.4.3/run/cloudera-scm-server/ --no-create-home --shell=/bin/false --comment &quot;Cloudera SCM User&quot; cloudera-scm</span><br></pre></td></tr></table></figure>
</li>
<li><p><em>主节点</em> 安装置Cloudera Manager Server 和AgentServer（主节点）</p>
<ol>
<li>下载地址：<a href="http://archive-primary.cloudera.com/cm5/cm/5/" target="_blank" rel="noopener">http://archive-primary.cloudera.com/cm5/cm/5/</a><br>我选的是cloudera-manager-el6-cm5.4.3_x86_64.tar.gz，完成后上传到主节点<br>然后解压到/opt目录下，不能解压到其它地方</li>
<li>加mysql-java 驱动<br><code>cp mysql-connector-java-5.1.36-bin.jar /opt/cm-5.4.3/share/cmf/lib/</code></li>
<li>将parcel 放入 1·<code>/opt/cloudera/parcel-repo/</code></li>
</ol>
</li>
</ul>
<ol>
<li>创建cm数据库<br><code>/opt/cm-5.4.3/share/cmf/schema/scm_prepare_database.sh mysql cm -hlocalhost -uroot -p123456 --scm-host localhost scm scm scm</code></li>
<li>开启Cloudera Manager 5 Server端<br><code>/opt/cm-5.4.3/etc/init.d/cloudera-scm-server start</code></li>
</ol>
<ul>
<li><p><em>所有节点</em> Agent配置<br>[注意]主节点如果也需要启动hdfs yarn等服务的话是需要同时启动server和agent的<br>1.主节点修改/opt/cm-5.4.3/etc/cloudera-scm-agent/config.ini下面的serer_host为主节点的主机名<br><code>vi /opt/cm-5.4.3/etc/cloudera-scm-agent/config.ini</code><br><code>server_host=x.x.x.x</code></p>
<ol>
<li>复制/opt/cm-5.4.3到所有slave节点上<br><code>scp -r /opt/cm-5.4.3 root@r01-hadoop04.com:/opt/</code></li>
<li>等待拷贝成功，在所有节点上启动Agent：（注意必须以管理员权限启动）<br><code>/opt/cm-5.4.3/etc/init.d/cloudera-scm-agent start</code></li>
</ol>
</li>
</ul>
<ol>
<li>浏览器启动Cloudera Manager 5 控制台（默认端口号是7180），启动成功就会看到登陆页面<br><code>http://10.60.28.1/cloudera-manager</code></li>
</ol>
<h3 id="3-安装-CDH"><a href="#3-安装-CDH" class="headerlink" title="3 安装 CDH"></a>3 安装 CDH</h3><p><em>Select Repository</em> 中选择  <strong>Custom Repository</strong>,然后填入<br>repo地址</p>
<p><strong>遇到的问题</strong></p>
<ol>
<li><p>对于此 Cloudera Manager 版本 (5.4.3) 太新的 CDH 版本不会显示<br>问题描述：Versions of CDH that are too new for this version of Cloudera Manager (5.4.3) will not be shown.<br>问题定位：PARCELS表没有记录，判断为parcel文件问题或scm数据库生成干扰问题<br>解决思路：<strong>判断为/opt/cloudera/parcel-repo/目录内的本地parcel应该在cm数据库初始化前放入，cm这样初始化时就能读取parcel-repo的数据啦</strong><br>问题解决：停止server-&gt;删除cm数据库-&gt;复制parcel到/opt/cloudera/parcel-repo/-&gt;创建cm数据库&gt;启动server&gt;</p>
</li>
<li><p>在安装Hive时，connection测试，需要密码，</p>
</li>
<li>在安装Oozie时，connection测试，不需要密码</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/14/bash_script-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ted1769">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="追寻事">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/14/bash_script-1/" itemprop="url">bash 脚本笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-12-14T11:33:19+08:00">
                2017-12-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="bash变量"><a href="#bash变量" class="headerlink" title="bash变量"></a>bash变量</h3><h4 id="1）-本地变量"><a href="#1）-本地变量" class="headerlink" title="1） 本地变量"></a>1） 本地变量</h4><blockquote>
<p><code>name=value</code> 读取变量 <code>$name</code> 作用域整个bash进程<br>这里省略了 set, <code>set name=value</code>，<br>撤销变量 <code>unset name</code>,不加<code>$</code>(针对变量本身不加<code>$</code>,如果针对变量的值就需要<code>$</code>)</p>
</blockquote>
<h4 id="2）-局部变量"><a href="#2）-局部变量" class="headerlink" title="2） 局部变量"></a>2） 局部变量</h4><blockquote>
<p><code>LOCAL name= value</code> 作用域为当前代码段</p>
</blockquote>
<h4 id="3）-环境变量"><a href="#3）-环境变量" class="headerlink" title="3） 环境变量"></a>3） 环境变量</h4><blockquote>
<p>作用域为当前shell进程及其子进程</p>
</blockquote>
<p>脚本在执行时会启动一个子shell进程:</p>
<blockquote>
<p>命令行中启动的脚本会继承当前shell的环境变量<br>系统自动执行的脚本（比如：crontab) 就需要自我定义环境变量了。</p>
</blockquote>
<h4 id="4）位置参数"><a href="#4）位置参数" class="headerlink" title="4）位置参数"></a>4）位置参数</h4><blockquote>
<p><code>$1</code>, 脚本的第一个参数</p>
</blockquote>
<h4 id="5）特殊参数"><a href="#5）特殊参数" class="headerlink" title="5）特殊参数"></a>5）特殊参数</h4><blockquote>
<p><code>$*</code>  输入了什么参数<br><code>$#</code>  输入了的参数个数<br><code>$1</code>  输入的第一个参数,依此类推，直到 $9<br><code>$?</code>  上一次的执行状态返回代码（0~255） 0没错误，其他有错误<br><code>$0</code>  该bash文件名<br><code>$@</code>  传给脚本的所有参数列表<br><code>$$</code>  脚本运行的当前进程ID</p>
</blockquote>
<h4 id="6）查看变量"><a href="#6）查看变量" class="headerlink" title="6）查看变量"></a>6）查看变量</h4><blockquote>
<p><code>set</code> 所有变量，本地变量和环境变量<br><code>env</code>,<code>printenv</code>,<code>export</code> 环境变量<br>著名的公式<br>$$ E=mc^2 $$</p>
</blockquote>
<h4 id="7-IFS-分隔符"><a href="#7-IFS-分隔符" class="headerlink" title="7) IFS 分隔符"></a>7) IFS <code>分隔符</code></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#! /usr/bin/env bash</span><br><span class="line"></span><br><span class="line">IFS.OLD=$IFS</span><br><span class="line">IFS=$&apos;\n&apos;</span><br><span class="line">for entry in `cat /etc/passwd`</span><br><span class="line">do</span><br><span class="line">        echo &quot;Values in $entry---&quot;</span><br><span class="line">        IFS=:</span><br><span class="line">        for value in $entry</span><br><span class="line">        do</span><br><span class="line">                echo &quot;  $value&quot;</span><br><span class="line">        done</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<h4 id="8-错误处理"><a href="#8-错误处理" class="headerlink" title="8) 错误处理"></a>8) 错误处理</h4><p>在很多脚本里看到 <code>set -e</code></p>
<blockquote>
<p><code>set -e</code>:Exit immediately if a command exits with a non-zero status. 最好脚本都加上</p>
</blockquote>
<p>但是<strong><em>直接退出</em></strong>并不是一个最佳实践，better use :<br><code>trap &#39;do_something&#39; ERR</code><br>to <code>run do_something</code> function when errors will occurs.</p>
<h3 id="文件测试"><a href="#文件测试" class="headerlink" title="文件测试"></a>文件测试</h3><ol>
<li>[ -d target ] target 是否是 目录</li>
<li>[ -f target ] 是否是文件</li>
<li>[ -e target ] 是否存在（目录和文件都适用）</li>
<li>[ -x target ] 可执行文件</li>
<li>[ -n “target” ] 是否为null,用双引号把变量名括</li>
<li>[ -s target ] 如果文件存在且非空</li>
<li>[ -z target] 是否是空</li>
</ol>
<h3 id="数值型比较"><a href="#数值型比较" class="headerlink" title="数值型比较"></a>数值型比较</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//变量赋值时,”=” 左右两边不能有空格</span><br><span class="line">age=30</span><br><span class="line"><span class="keyword">if</span> [ $ -ge 20]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span>“age is bigger than 20”</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span>“age is less than 20”</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">// ---others-----</span><br><span class="line">–eq(equals)</span><br><span class="line">–ne(not equal)</span><br><span class="line">-gt( greater than)</span><br><span class="line">-lt(lessthan)</span><br><span class="line">-ge(greater or equal than)</span><br><span class="line">-le(less than or equal )</span><br></pre></td></tr></table></figure>
<p>eg:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">bootpercent= df –hT | grep “sda1” | awk “&#123;<span class="built_in">print</span> <span class="variable">$6</span>&#125;” | cut –d <span class="string">"%"</span> –f1</span><br><span class="line">   <span class="keyword">if</span> [<span class="variable">$bootpercent</span> –ge 80 ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"percent is bigger than 80,warning!!!"</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"percent is less than 80"</span></span><br><span class="line">   <span class="keyword">fi</span></span><br></pre></td></tr></table></figure></p>
<h3 id="字符串比较"><a href="#字符串比较" class="headerlink" title="字符串比较"></a>字符串比较</h3><pre><code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># "=" 需要空格</span></span><br><span class="line">[ str1= str2 ] </span><br><span class="line"><span class="comment"># str 是否为空</span></span><br><span class="line">[ -z str ]</span><br></pre></td></tr></table></figure>
</code></pre><h3 id="逻辑条件测试"><a href="#逻辑条件测试" class="headerlink" title="逻辑条件测试"></a>逻辑条件测试</h3><blockquote>
<p>&amp;&amp;  ||<br>if<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">If [ <span class="variable">$age</span>–ge 30 ];<span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">"great than 30"</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="variable">$age</span> –ge 40 ];<span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> “great <span class="keyword">then</span> 40”</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   <span class="built_in">echo</span> “50”</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure></p>
<p>case<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#`` 里面是命令：今天周几</span></span><br><span class="line">week= `date +%w` </span><br><span class="line">       <span class="keyword">case</span><span class="variable">$week</span> <span class="keyword">in</span> : </span><br><span class="line">       start):</span><br><span class="line">           <span class="built_in">echo</span>“start”</span><br><span class="line">           ;;</span><br><span class="line">       stop):</span><br><span class="line">           <span class="built_in">echo</span>“stop”</span><br><span class="line">           ;;</span><br><span class="line">       *):</span><br><span class="line">           Echo “other”</span><br><span class="line">           ;;</span><br><span class="line">       <span class="keyword">esac</span></span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="循环条件测试"><a href="#循环条件测试" class="headerlink" title="循环条件测试"></a>循环条件测试</h3><blockquote>
<p>while<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">num=3</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$num</span> –ge 0 ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span><span class="variable">$num</span></span><br><span class="line">    num=$((<span class="variable">$num</span>-1)) <span class="comment"># ‘=’左边的num不需要$ ?</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">    <span class="built_in">echo</span><span class="variable">$num</span></span><br></pre></td></tr></table></figure></p>
<p>for<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> ` cat /var/user.txt`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span><span class="variable">$i</span></span><br><span class="line">    echo123 | passwd –stdin <span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="shift：传入的参数左移"><a href="#shift：传入的参数左移" class="headerlink" title="shift：传入的参数左移"></a>shift：传入的参数左移</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">num=0</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$#</span> -gt 0 ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">        num=$((num+ <span class="variable">$1</span>))</span><br><span class="line">        <span class="built_in">shift</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$num</span></span><br></pre></td></tr></table></figure>
<h3 id="find"><a href="#find" class="headerlink" title="find"></a>find</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">find/etc/ -perm 755 –<span class="built_in">type</span> f</span><br><span class="line"><span class="comment"># 跟find /etc –perm 755 | find –type f 不是一样，切记</span></span><br><span class="line">find /etc –user root</span><br><span class="line">find /etc –iname <span class="string">'user*'</span> | xargs rm –f</span><br></pre></td></tr></table></figure>
<h3 id="awk"><a href="#awk" class="headerlink" title="awk"></a>awk</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># $0-&gt;整行，$1-&gt;第一列</span></span><br><span class="line"><span class="comment"># NR(Number Row):行号</span></span><br><span class="line"><span class="comment"># NF(Number Field):列号</span></span><br><span class="line"></span><br><span class="line">cat/etc/passwd | awk –F <span class="string">":"</span> <span class="string">'&#123;if(NR==3)print $1,$4&#125;'</span> -&gt;打印第三行的第一个和第四个字段</span><br><span class="line">cat/etc/passwd | awk –F <span class="string">'END&#123;print NR&#125;'</span> -&gt;总共多少行</span><br><span class="line">cat/etc/passwd | awk –F ‘END&#123;<span class="built_in">print</span> NF&#125;’ -&gt;总共多少列</span><br><span class="line">cat/etc/passwd | awk –F “:” ‘&#123;<span class="function"><span class="title">if</span></span>()&#123;<span class="built_in">print</span> <span class="variable">$1</span>”\t”<span class="variable">$4</span>&#125;&#125;’</span><br><span class="line">cat/etc/passwd | awk ‘<span class="variable">$1</span> ~/192.168.10.1/ &#123;<span class="built_in">print</span> <span class="variable">$0</span> &#125; ’  -&gt; ~ 匹配，!~ 不匹配</span><br></pre></td></tr></table></figure>
<h3 id="sed"><a href="#sed" class="headerlink" title="sed"></a>sed</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># p -&gt; print, d-&gt; delete</span></span><br><span class="line">cat/etc/passwd | sed –n <span class="string">'5'</span>p –&gt; 打印第五行</span><br><span class="line">cat/etc/passwd | sed <span class="string">'3,6'</span>d -&gt; 打印删除3-6行之后的内容</span><br><span class="line">cat/etc/passwd | sed <span class="string">'/bash/'</span> p -&gt; 打印匹配bash 的行</span><br><span class="line">cat/etc/passwd | sed –n <span class="string">'1,/sync/'</span>p -&gt; 打印第一行到匹配sync的行</span><br><span class="line">cat/etc/passwd | sed –n <span class="string">'/root/,$'</span>p -&gt; 打印从匹配root 到结尾的所有行</span><br><span class="line">cat/etc/passwd | sed –n <span class="string">'3'</span>p | awk –F <span class="string">":"</span> <span class="string">'&#123;print $4&#125;'</span> –&gt; 39%</span><br><span class="line">cat/etc/passwd | sed –n <span class="string">'3'</span>p | awk –F <span class="string">":"</span> <span class="string">'&#123;print int($4)&#125;'</span> –&gt; 39</span><br></pre></td></tr></table></figure>
<h3 id="uniq-与-sort"><a href="#uniq-与-sort" class="headerlink" title="uniq 与 sort"></a>uniq 与 sort</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">uniq–c  <span class="comment">#统计连续的次数</span></span><br><span class="line">catfile | sort –t: -k1 –r <span class="comment"># 以：为分隔符，取第一列，倒序排列</span></span><br></pre></td></tr></table></figure>
<h3 id="linux-启动流程"><a href="#linux-启动流程" class="headerlink" title="linux 启动流程"></a>linux 启动流程</h3><h4 id="初始化阶段"><a href="#初始化阶段" class="headerlink" title="初始化阶段"></a>初始化阶段</h4><p> 1). Grub 引导界面<br> 2). 识别硬件<br> 3). 初始化驱动</p>
<h4 id="加载-etc-rc-d-rc-sysinit-系统初始化"><a href="#加载-etc-rc-d-rc-sysinit-系统初始化" class="headerlink" title="加载/etc/rc.d/rc.sysinit 系统初始化"></a>加载/etc/rc.d/rc.sysinit 系统初始化</h4><p> 4). 进入欢迎界面<br> 5). 设置时钟<br> 6). 设置主机名<br> 7). 挂载文件系统<br> 8). 挂载光驱<br> 9). 进入3级别<br> 10). 启动虚拟内存<br> 11). 设置磁盘阵列</p>
<h4 id="加载-etc-rc-d-rc-进程管理脚本"><a href="#加载-etc-rc-d-rc-进程管理脚本" class="headerlink" title="加载 /etc/rc.d/rc 进程管理脚本"></a>加载 /etc/rc.d/rc 进程管理脚本</h4><p> 12). 设置防火墙<br> 13). 检测硬件变化<br> 14). 启动网络服务<br> 15). 启动3级别中允许启动的进程(/etc/rc.d/rc3.d中以S开头的服务名,S99以后就是登陆界面了)<br> 16). 进入登陆界面</p>
<h3 id="运行级别：-默认是3"><a href="#运行级别：-默认是3" class="headerlink" title="运行级别：(默认是3)"></a>运行级别：(默认是3)</h3><blockquote>
<p><code>0</code>: halt<br><code>1</code>: singlemode user<br><code>2</code>: multiuser without NFS<br><code>3</code>: full multiuser<br><code>4</code>: unused<br><code>5</code>: X11 ( 3 with 图形界面)<br><code>6</code>: reboot (所以，重启的话reboot，还可以 init 6)<br>查看运行级别 runlevel</p>
</blockquote>
<h3 id="如何设置服务脚本在某个级别下开启或者关闭-以sshd为例"><a href="#如何设置服务脚本在某个级别下开启或者关闭-以sshd为例" class="headerlink" title="如何设置服务脚本在某个级别下开启或者关闭(以sshd为例)"></a>如何设置服务脚本在某个级别下开启或者关闭(以sshd为例)</h3><p> 1).  查看sshd 服务在所有级别下的开关状态</p>
<pre><code>`chkconfig –list sshd`
</code></pre><p> 2).  sshd 在 3 级别下开启/关闭</p>
<pre><code>`chkconfig –level 3 sshd on/off`
</code></pre><p> 3). 将自己的服务脚本改造成标准的rpm脚本<br>   <code>cp sshd /etc/init.d</code><br>    在 xxx 中添加：</p>
<p><code>#chkconfig:2345 90 20</code> (90为开机的顺序，20为关机的顺序，数值越大，优先级越高，自定义的脚本开机应较晚5，关机较早)<br><code>#descrption: xxx server daemon</code></p>
<p> 4). 通过service 把自定义脚本进行开启和关闭<br> <code>service xxx start|stop|restart</code></p>
<p> 5). 通过chkconfig把自定义脚本设置为开机启动<br>    <code>chkconfig xxx on/off</code></p>
<h3 id="原格式输出字符以及调用其他脚本"><a href="#原格式输出字符以及调用其他脚本" class="headerlink" title="原格式输出字符以及调用其他脚本"></a>原格式输出字符以及调用其他脚本</h3><blockquote>
<p>menu.sh</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Cat 的 heredoc使用方法</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line">cat &lt;&lt; eof</span><br><span class="line">              aaaaaaaaaaaaaa</span><br><span class="line">              bbbbbbbbbbbbb</span><br><span class="line">              cccccccccccccccc  </span><br><span class="line">eof</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 引用 menu.sh</span></span><br><span class="line">. menu.sh</span><br></pre></td></tr></table></figure>
<h3 id="设置颜色"><a href="#设置颜色" class="headerlink" title="设置颜色"></a>设置颜色</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># \033[ 设置颜色的标志，30 前底色，47 背景色，0m 还原</span></span><br><span class="line"><span class="built_in">echo</span> –e <span class="string">"\033[30;47m <span class="variable">$str</span> \033[0m"</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">ted1769</p>
              <p class="site-description motion-element" itemprop="description">一个博客</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">27</span>
                  <span class="site-state-item-name">Artikel</span>
                </a>
              </div>
            

            

            

          </nav>

          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ted1769</span>

  
</div>


  <div class="powered-by">Erstellt mit  <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
